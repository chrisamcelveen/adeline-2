{% if settings.index_products_order == 'random' %}
  {% assign index_products_limit = 10000 %}
{% else %}
  {% assign index_products_limit = settings.index_products_limit %}
{% endif %}

<section>

  {% if settings.index_products_title != '' %}
    <h2>{{ settings.index_products_title }}</h2>
  {% endif %}

  <div class="products cards" data-order="{{settings.index_products_order}}">
    <ul class="block-grid small-block-grid-1 medium-block-grid-{{settings.collection_products_per_row_medium}} large-block-grid-{{settings.collection_products_per_row_large}}">

    {% for product in collections[settings.index_products].all_products limit: index_products_limit %}

      {% if settings.index_products_tag_filter != '' %}
        {% for tag in product.tags %}
          {% if tag == settings.index_products_tag_filter %}
            <li>{% include 'product-small' %}</li>
          {% endif %}
        {% endfor %}
      {% else %}
        <li>{% include 'product-small' %}</li>
      {% endif %}

    {% endfor %}

    </ul>
  </div>

</section>